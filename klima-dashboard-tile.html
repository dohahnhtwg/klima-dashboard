<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-scroll-target-behavior/iron-scroll-target-behavior.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<!--
`klima-dashboard-tile`
tile of klima-dashboard

-->

<dom-module id="klima-dashboard-tile">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        border-style: solid;
        box-sizing: border-box;
      }
      #overflowContainer {
        position: relative;
        width: 100%;
        height: 100%;
        overflow-x: auto;
        overflow-y: hidden;
      }
      .buttons {
        display: block;
        top: 40%;
        height: 20%;
        width: 20px;
        background-color: grey;
        opacity: 0.2;
        z-index: 1;
      }
      #rightButton {
        position: absolute;
        right: 0px;
      }
      #leftButton {
        position: absolute;
        left: 0px;
      }
      .icons {
        top: 25%;
        height: 50%;
      }
    </style>
      <div id="overflowContainer">
        <content></content>
     </div>
     <div id="leftButton" class="buttons" hidden="{{!leftButtonVisible}}" on-tap="_nextLeftTile">
       <iron-icon class="icons" icon="icons:chevron-left"></iron-icon>
     </div>
     <div id="rightButton" class="buttons" hidden="{{!rightButtonVisible}}" on-tap="_nextRightTile">
       <iron-icon class="icons" icon="icons:chevron-right"></iron-icon>
     </div>
  </template>

  <script>
    Polymer({
      is: 'klima-dashboard-tile',
      properties: {
        row: {
          type: Number,
          value: 0
        },
        overlap: {
          type: Number,
          value: 0
        },
        width: {
          type: Number,
          value: 0
        },
        leftNeighbour: {
          type: Object
        },
        rightNeighbour: {
          type: Object
        },
        positions: {
          type: Array,
          value: [1]
        },
        minWidth: {
          type: Number,
          type: Infinity
        },
        isDisplayed: {
          type: Boolean,
          value: true,
          observer: '_displayedChanged'
        },
        nextRightTile: {
          type: Object,
          observer: '_nextRightTileChanged'
        },
        nextLeftTile: {
          type: Object,
          observer: '_nextLeftTileChanged'
        },
        rightButtonVisible: {
          type: Boolean,
          value: false
        },
        leftButtonVisible: {
          type: Boolean,
          value: false
        }
      },

      _displayedChanged: function(newValue) {
        this.hidden = !newValue;
        this.fire('isDisplayedChanged', newValue);
      },

      setBorder: function(top, right, bottom, left, color) {
        this.style.borderTopWidth = top;
        this.style.borderRightWidth = right;
        this.style.borderBottomWidth = bottom;
        this.style.borderLeftWidth = left;
        this.style.borderColor = color;
      },

      _nextRightTileChanged: function(newValue) {
        if(newValue == null) {
          this.rightButtonVisible = false;
        } else {
          this.rightButtonVisible = true;
        }
      },

      _nextLeftTileChanged: function(newValue) {
        if(newValue == null) {
          this.leftButtonVisible = false;
        } else {
          this.leftButtonVisible = true;
        }
      },

      _nextLeftTile: function(e) {
        e.preventDefault()
        e.stopPropagation();
        if(this.nextLeftTile == null) {
          console.warn("No tile to focus");
        } else {
          this.nextLeftTile();
        }
      },
      _nextRightTile: function(e) {
        e.preventDefault()
        e.stopPropagation();
        if(this.nextRightTile == null) {
          console.warn("No tile to focus");
        } else {
          this.nextRightTile();
        }
      },
      isLastVisibleTileInRow: function() {
        if(!this.isDisplayed) {return false;}
        var rightNeighbour = this.rightNeighbour;
        while(rightNeighbour != null && !rightNeighbour.isDisplayed) {
          rightNeighbour = rightNeighbour.rightNeighbour;
        }
        if(rightNeighbour == null) {
          return true;
        }
        return false;
      },
      isFirstVisibleTileInRow: function() {
        if(!this.isDisplayed) {return false;}
        var leftNeighbour = this.leftNeighbour;
        while(leftNeighbour != null && !leftNeighbour.isDisplayed) {
          leftNeighbour = leftNeighbour.leftNeighbour;
        }
        if(leftNeighbour == null) {
          return true;
        }
        return false;
      }
    });
  </script>
</dom-module>
